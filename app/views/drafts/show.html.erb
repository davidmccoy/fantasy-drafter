<h2>Your Draft For <%= @draft.tournament.competition.name %></h2>

<% if !@draft.start_time %>
  <p>
    Please select a start time for your draft.
  </p>

  <%= form_for [@draft.tournament.competition.game, @draft.tournament.competition, @draft.tournament, @draft] do |f| %>
    <%= f.label "Start Time: " %>
    <%= f.datetime_field :start_time %>

    <%= f.submit %>
  <% end %>
<% elsif @draft.completed %>
  <p>
    Your draft has finished.
  </p>
<% elsif @draft.active || Time.now > @draft.start_time %>
  <div style="display:inline-block; width:50%; vertical-align:top;">
    <h3> Current Pick: <%= "#{@current_pick.user.name} (Pick \##{@current_pick.number})" %> </h3>

    <h4>
      Pick Order:
    </h4>

    <% @draft.picks.sort_by{ |pick| pick.number }.each_with_index do |pick, index| %>
    <% if pick.player_id.nil? %>
      <p>
        <%= "#{index + 1}: #{pick.user.name}" %>
      </p>
    <% else %>
      <p style="text-decoration:line-through;">
        <%= "#{index + 1}: #{pick.user.name}" %>
      </p>
    <% end %>
    <% end %>
  </div><div style="display:inline-block; width:50%; vertical-align:top;">
    <h4>
      Available Players:
    </h4>

    <% @available_players.each do |player| %>
    <p>
      <%= player.name %>
      <% if @current_pick.user == current_user || current_user == @draft.tournament.admin %>
      <%= link_to "Draft This Player", game_competition_tournament_draft_pick_path(@draft.tournament.competition.game, @draft.tournament.competition, @draft.tournament, @draft, @current_pick, player_id: player.id), method: :patch  %>
      <% end %>
    </p>
    <% end %>
  </div>

  <div>
    <h3>Teams</h3>
    <% @draft.tournament.users.each do |user| %>
    <div style="display:inline-block; width:24%; vertical-align:top;">
      <h4><%= user.name %></h4>
      <% @draft.picks.where(user_id: user).where.not(player_id: nil).each do |pick| %>
        <p>
          <%= pick.player.name %>
        </p>
      <% end %>
    </div>
    <% end %>
  </div>
<% else %>
  <p>
    Start Time: <%= @draft.start_time.localtime.strftime("%A %B %e, %Y at %l:%M %p") %>
  </p>
  <p>
    Your draft hasn't started yet.
  </p>
<% end %>
