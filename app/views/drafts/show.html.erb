<div id="draft">
  <h2>Your Draft For <%= @draft.tournament.competition.name %></h2>

  <% if !@draft.start_time %>
    <p>
      Please select a start time for your draft.
    </p>

    <%= form_for [@draft.tournament.competition.game, @draft.tournament.competition, @draft.tournament, @draft] do |f| %>
      <%= f.label "Start Time: " %>
      <%= f.datetime_field :start_time %>

    <%= f.submit %>
  <% end %>
  <% elsif @draft.completed %>
    <p>
      Your draft has finished.
    </p>
  <% elsif @draft.active || Time.now > @draft.start_time %>
    <div id="picks" class="row">
      <div class="current-pick-container col-md-2">
        <p>
          Current Pick
        </p>
        <p id="current-pick">
          <%= @current_pick.user.name %>
        </p>
      </div>
      <div class="pick-order-container col-md-10">
        <div class="pick-order">
          <% @draft.picks.sort_by{ |pick| pick.number }.each_with_index do |pick, index| %>
            <% if pick.player_id.nil? %>
              <div class="pick" id="pick-<%= pick.number %>">
                <div class="pick-number <%= pick.number %>">
                  <span class="pick-number-label">
                    PICK
                  </span>
                  <span>
                    <%= pick.number %>
                  </span>
                </div>
                <div class="pick-info">
                  <p>
                    <%= pick.user.name %>
                  </p>
                </div>
              </div>
            <% else %>
              <div class="pick picked" id="pick-<%= pick.number %>">
                <div class="pick-number">
                  <span class="pick-number-label">
                    PICK
                  </span>
                  <span>
                    <%= pick.number %>
                  </span>
                </div>
                <div class="pick-info">
                  <p>
                    <%= pick.user.name %>
                  </p>
                  <p>
                    <%= pick.player.name %>
                  </p>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
    <div id="players" style="display:inline-block; width:50%; vertical-align:top;">
      <h4>
        Available Players:
      </h4>

      <% @available_players.each do |player| %>
      <p id="<%= player.id %>">
        <%= player.name %>
        <% if @current_pick.user == current_user || current_user == @draft.tournament.admin %>
        <%= link_to "Draft This Player", game_competition_tournament_draft_pick_path(@draft.tournament.competition.game, @draft.tournament.competition, @draft.tournament, @draft, @current_pick, player_id: player.id, protocol: "https"), method: :patch, remote: true, class: "pick-link"  %>
        <% end %>
      </p>
      <% end %>
    </div>
  <% else %>
    <p>
      Start Time: <%= @draft.start_time.localtime.strftime("%A %B %e, %Y at %l:%M %p") %>
    </p>
    <p>
      Your draft hasn't started yet.
    </p>
  <% end %>
</div>

<script>
  // update position of pick order banner
  <% if @current_pick.number == 1 %>
    $pick = $('#pick-' + <%= @current_pick.number %>);
  <% else %>
    $pick = $('#pick-' + (<%= @current_pick.number %> - 1));
  <% end %>
  $pickLeft = $pick.position().left
  $('.pick-order-container').scrollLeft($('.pick-order-container').scrollLeft() + $pickLeft)
</script>
